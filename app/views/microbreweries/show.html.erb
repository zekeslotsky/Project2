<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

 <style>
      #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

 <h1> <%= @microbrewery.name %> </h1>
<div class = "container">
<div class = "row">
    <p>This Microbrewery is a <%= @microbrewery.style %> style from <%= @microbrewery.city %>, and we can take <%= @microbrewery.transit %> to get there.</p>
    <h3>If you're going the best transit is:</h3>
    <h4><%= @microbrewery.transit %> !!!</h4><br>
    	Address: <%= @microbrewery.address %><br>
        City: <%= @microbrewery.city %><br>
        Zip: <%= @microbrewery.zip %><br><br>
       
        Direction: <%= @microbrewery.direction %><br>
        Style: <%= @microbrewery.style %><br>
        Beer1: <%= @microbrewery.beer1 %><br>
        Beer2: <%= @microbrewery.beer2 %><br>
        Beer3: <%= @microbrewery.beer3 %><br>
        Do they allow Generic Growlers?: <%= @microbrewery.generic_growlers %><br>

    <%= link_to "Back to the list!", microbreweries_path %>
     <%= link_to "Edit", edit_microbrewery_path %>
     <%= link_to "", @microbrewery, {method: :delete, data: {confirm: 'Are you sure you want to delete it?' }, class: "glyphicon glyphicon-trash"} %>


    </div>
</div>
<hr>

 <div class="container">
  
   <br><h2>Map of Breweries</h2>
   <%= stylesheet_link_tag    "application" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  
<div style='width: 800px;'>
  <div id="directions" style='width: 800px; height: 400px;'></div>
</div>


  <script type="text/javascript">
var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();

function calcRoute() {
  var origin      = new google.maps.LatLng(41.850033, -87.6500523);
  var destination = new google.maps.LatLng(41.950033, -87.6500523);
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.TRANSIT
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

calcRoute();

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'directions'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});
    

   </script>


   <script>

var rendererOptions = {
  draggable: true
};
var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);;
var directionsService = new google.maps.DirectionsService();
var map;

var australia = new google.maps.LatLng(34.012836, -118.495338);

function initialize() {

  var mapOptions = {
    zoom: 7,
    center: australia
  };
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  directionsDisplay.setMap(map);
  directionsDisplay.setPanel(document.getElementById('directionsPanel'));

  google.maps.event.addListener(directionsDisplay, 'directions_changed', function() {
    computeTotalDistance(directionsDisplay.getDirections());
  });

  calcRoute();
}

function calcRoute() {

  var request = {
    origin: '1520 2nd Street, Santa Monica, 90401',
    destination: ' <%= @microbrewery.address %>, <%= @microbrewery.zip %>',

    travelMode: google.maps.TravelMode.TRANSIT
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

function computeTotalDistance(result) {
  var total = 0;
  var myroute = result.routes[0];
  for (var i = 0; i < myroute.legs.length; i++) {
    total += myroute.legs[i].distance.value;
  }

}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>

    <div id="map-canvas" style="float:left;width:70%; height:100%">
    </div>
    <div id="directionsPanel" style="float:right;width:30%;height 100%">
    
    </div>
 </div>
